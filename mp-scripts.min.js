!function(){jQuery(document).ready(function(a){function c(b){var d,e,c=b.next(),f=parseInt(c.find("input#rfbwp_fb_page_index").attr("value"));if(e=b.find("span.page-index").text(),e=e.split("-"),e=parseInt(e[0]),d=e>f?"up":"down",e!=f){var g;b.slideUp(),c.remove(),b.parents("table.pages-table").find("tr.page-set").each(function(){var b=a(this);"down"==d?f>=parseInt(b.find("input#rfbwp_fb_page_index").attr("value"))&&(g=b):f>=parseInt(b.find("input#rfbwp_fb_page_index").attr("value"))&&(g=b)}),"down"==d?(b.find("span.page-index").text(f),b.slideUp("fast",function(){g.after(c),g.after(b),b.slideDown(),P(a(this).parents("div.pages")),N(a(this).parents("div.pages"))})):(b.find("span.page-index").text(f),b.slideUp("fast",function(){g.prev().before(b),g.prev().before(c),b.slideDown(),P(a(this).parents("div.pages")),N(a(this).parents("div.pages"))}))}else P(a(this).parents("div.pages")),N(a(this).parents("div.pages"))}function d(a){var b=U(a.attr("id")),c=a.parents(".pages-table");c.find("#"+a.attr("id")).after(c.find("#pset_"+b))}function e(b){var c=1;b.find(".stacked-fields:not(:first-child):not(:last-child)").each(function(){var b=a(this),d=b.find(".checkbox").is(":checked");d&&(b.find("#"+b.data("section-id")+"_order input").val(c),c++)})}function f(b){var c=b.find(".stacked-fields:first-child"),d=b.find(".stacked-fields:last-child"),e=b.find(".stacked-fields:not(:first-child):not(:last-child)"),f=e.sort(function(b,c){var d=a(b).find("#"+a(b).data("section-id")+"_order input").val(),e=a(c).find("#"+a(c).data("section-id")+"_order input").val();return d>e});b.append(c),b.append(f),b.append(d)}function g(b){var c=0;b.find("tr.display").each(function(){var b=a(this);b.next().hasClass("page-set")||d(b);var e=b.next(),f=b.find(".page-index"),g=e.find("input#rfbwp_fb_page_index");g.find("input#rfbwp_fb_page_index").attr("value",c),"Double Page"===e.find("select.rfbwp-page-type option:selected").text()?(f.text(c+" - "+(c+1)),c+=2):(f.text(c),c++)}),K(b.parents("div.pages"));var e=b.parents(".pages").attr("id"),f=U(e);a(".wrap").find("form#options-form a.edit-button").attr("href","#"+f).attr("value","Edit Settings"),a(".wrap").find("form#options-form a.edit-button").trigger("click",["sortable"])}function h(c){a(this).fadeIn(300),b.stop(!0).fadeOut(200,function(){G()})}function j(a){if(!a.parent().find(".rfbwp_page_css_handler").length){var b="rfbwp_css_"+Math.floor(1e4*Math.random()),c=i.length;a.before('<div class="rfbwp_page_css_handler" id="'+b+'" data-index="'+c+'"></div>'),i[c]=ace.edit(b);var d=a.hide();i[c].getSession().setValue(d.val()),i[c].getSession().setMode("ace/mode/css"),i[c].getSession().on("change",function(){d.val(i[c].getSession().getValue())})}}function k(b){var c=b.parents(".page-settings"),d=c.find("#rfbwp_fb_page_type").val(),e=b.parents("tr.page-set").find("#field-rfbwp_page_html_second");b.find(".html-editor").each(function(){var b=a(this),c=b.parents(".field").attr("id").replace("field-",""),d="rfbwp_html_"+Math.floor(1e4*Math.random());null===tinymce.get(b.attr("id"))&&(b.attr("id",d),tinyMCE.init({mode:"exact",relative_urls:!1,elements:d,skin:"mpc-flipbook",height:"240px",force_br_newlines:!0,force_p_newlines:!1,entity_encoding:"raw",verify_html:!1,plugins:["autolink lists link image hr anchor","code media nonbreaking paste textcolor colorpicker textpattern"],image_advtab:!0,menubar:!1,toolbar1:"undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | code"}),b.attr("data-editor",c))}),"Single Page"==d&&e.hasClass("active")?(c.find("#field-rfbwp_fb_page_columns_sc a").trigger("click"),c.find("#field-rfbwp_fb_page_columns_sc").removeClass("active")):"Double Page"!=d||e.hasClass("active")||(c.find("#field-rfbwp_fb_page_columns_sc").addClass("active"),c.find("#field-rfbwp_fb_page_columns_sc a").trigger("click"))}function l(a){if(0==a.find("tr.display").length){var b=a.find("img.rfbwp-first-page").clone(!0);a.find("img.rfbwp-first-page").remove(),a.find("table.pages-table").after(b),a.find("img.rfbwp-first-page").css({display:"inline-block"})}}function m(a){a.find(".stacked-fields:not(:first-child):not(:last-child)").append('<div class="mpc-sortable-handle"><i class="fa fa-arrows-v"></i></div>'),f(a),a.sortable({items:"> .stacked-fields:not(:first-child):not(:last-child)",placeholder:"stacked-fields ui-state-highlight",handle:".mpc-sortable-handle"}),a.on("sortupdate",function(b,c){e(a)}),a.find(".stacked-fields:not(:first-child):not(:last-child) .checkbox").on("change",function(){e(a)})}function n(b){b.find(".pages-table tbody").sortable({items:"> tr:not(.page-set)",placeholder:"page-set ui-state-highlight",handle:".mpc-sortable-handle"}),b.find(".pages-table tbody").on("sortupdate",function(b,c){var d=a(this);g(d.parents(".pages-table"))})}function o(b){b.find(".field-select").each(function(){var b=a(this).find(".mp-dropdown");b.data("select2")||b.select2({minimumResultsForSearch:10})})}function p(b){b.find(".field-color").each(function(){var b=a(this);b.find("input").hasClass("wp-color-picker")||b.find("input").wpColorPicker()})}function q(b){var c=a("#mpc_icon_select_grid_modal");b.each(function(){var b=a(this);b.find(".mpc-icon-select").each(function(){var b=a(this),d=b.siblings(".mpc-icon-select-clear"),e=b.siblings(".mpc-icon-select-value"),f=b.children("i");b.on("click",function(a){c.length&&(c.dialog("option","target",b),c.dialog("open")),a.preventDefault()}),b.on("mpc.update",function(a,c){e.val(c),f.attr("class",c),b.removeClass("mpc-icon-select-empty")}),d.on("click",function(a){e.val(""),f.attr("class",""),b.addClass("mpc-icon-select-empty"),a.preventDefault()})})})}function r(b){var c=a("#mpc_toc_generator_modal"),d=c.find("#toc_item_markup").clone().removeAttr("id"),e=c.find("#mpc_toc_items").html(""),f=b.parents("#field-rfbwp_pages").find("tr.page-set"),g=0;f.each(function(){var b=a(this),c=d.clone(),f=b.find("#rfbwp_fb_page_title").val(),h=b.find("#rfbwp_fb_page_index").val();g++,c.find(".page-checkbox").attr("name","page["+g+"]"),c.find(".page-lp").html(g),c.find(".page-title").html(f),c.find(".page-number").html(h),e.append(c)})}function s(b){var c=a("#mpc_toc_generator_modal");b.each(function(){var b=a(this);b.find(".rfbwp-page-toc-popup").each(function(){var b=a(this);b.on("click",function(a){var d=b.parents(".field").next().find(".html-editor").attr("id");c.length&&(r(b),c.dialog("option","target",d),c.dialog("open")),a.preventDefault()})})})}function t(a){var b=a.find("#field-rfbwp_fb_nav_zoom input#rfbwp_fb_nav_zoom:checked"),c=a.find("#field-rfbwp_fb_nav_arrows input#rfbwp_fb_nav_arrows:checked"),d=a.find("#field-rfbwp_fb_nav_zoom .mp-tooltip");b.length>0&&c.length<1?d.show():d.hide()}function C(a){if(a){var b=new wp.shortcode({tag:"gallery",attrs:{ids:a},type:"single"}),c=wp.media.gallery.attachments(b),d=new wp.media.model.Selection(c.models,{props:c.props.toJSON(),multiple:!0});return d.gallery=c.gallery,d.more().done(function(){d.props.set({query:!1}),d.unmirror(),d.props.unset("orderby")}),d}return!1}function F(b){b.find(".fb-dyn-images").each(function(){var b=a(this);b.attr("src",b.attr("data-src"))})}function G(){var b=a("#mp-option-books .books td");b.each(function(b,c){var d=mpcthLocalize.messages.errors.error,e=!1,f=0,g=a("#mp-option-pages_"+b+" .pages-table tr:not(.page-set)");g.each(function(b,c){"Single Page"==a(c).find(".page-type").html()?f++:f+=2}),"Single Page"!=g.first().find(".page-type").html()&&(d+=mpcthLocalize.messages.errors.firstPage,e=!0),"Single Page"!=g.last().find(".page-type").html()&&(e&&(d+=", ",e=!1),d+=mpcthLocalize.messages.errors.lastPage,e=!0),f<4&&(e&&(d+=", ",e=!1),d+=mpcthLocalize.messages.errors.minPages,e=!0),f%2!=0&&(e&&(d+=", ",e=!1),d+=mpcthLocalize.messages.errors.evenPages),d!=mpcthLocalize.messages.errors.error&&a(c).find(".book-error .distinction").html(d+".")})}function H(b,c){V(),a("div.bottom-nav").hide(),a("#rfbwp_tools").hide(),"book-settings"==b?(a("div.bottom-nav").find("a.edit-button").attr("value","Edit Settings").attr("href","#"+c),a("div.group.settings").find("div.mp-toggle-content:first").css("display","block"),a("div.group.settings").find("div.mp-toggle-header:first").addClass("open"),a("div.breadcrumbs").fadeIn(),a("div.breadcrumbs span.breadcrumb-1").addClass("selected"),a("div.breadcrumbs .edit-button-alt").css("display","block"),a("div.bottom-nav").fadeIn()):"books"==b||"help"==b?(G(),a("div.breadcrumbs").hide(),a("div.breadcrumbs .edit-button-alt").hide()):"add"==b?(a("div.breadcrumbs").fadeIn(),a("div.bottom-nav").fadeIn(),a("div.breadcrumbs .edit-button-alt").hide()):"view-pages"==b?(a("div.breadcrumbs").fadeIn(),a("div.breadcrumbs span.breadcrumb-2").addClass("selected"),a("div.breadcrumbs .edit-button-alt").hide(),a("#rfbwp_tools").fadeIn()):I()}function I(){X(),a.post(ajaxurl,{action:"rfbwp_refresh_books"},function(b){a("div.field-books div.controls").children().remove(),a("div.field-books div.controls").append(b),G(),Y()})}function J(b){var c=U(b);c-=1,a("table.page-table tr#pset_"+c).after(a("table.page-table tr#"+b))}function K(b){var c=-1,d=-1;b.find("tr.page-set").each(function(){var b=a(this);c++,d++,U(b.attr("id"))!=c.toString()&&b.attr("id","pset_"+c.toString()),b.prev().hasClass("display")&&U(b.prev().attr("id"))!=c.toString()&&b.prev().attr("id","page-display_"+c.toString()),void 0!=b.find("div.page-settings").attr("id")&&U(b.find("div.page-settings").attr("id"))!=c.toString()&&b.find("div.page-settings").attr("id","ps_"+c.toString()),b.find("div.controls").children().each(function(){var d,b=a(this);void 0!=b.attr("name")&&""!=b.attr("name")&&(d=b.attr("name"),d=d.split("[pages]"),d=b.hasClass("html-editor")&&b.attr("data-editor")?d[0]+"[pages]["+c+"]["+b.data("editor")+"]":d[0]+"[pages]["+c+"]["+b.attr("id")+"]",b.attr("name",d))}),b.find("input#rfbwp_fb_page_index").attr("value",d),"Double Page"==b.find("div#field-rfbwp_fb_page_type select").val()&&d++})}function N(b){b.find("tr.page-set").each(function(){var b=a(this),c=b.find("select.rfbwp-page-type option:selected").text(),d=b.find("input#rfbwp_fb_page_index").attr("value"),e=b.find("input#rfbwp_fb_page_bg_image").attr("value");if(void 0!=c&&void 0!=d)if(b.prev().hasClass("display"))b.prev().find("span.page-type").text(c),"Single Page"==c?b.prev().find("span.page-index").text(d):b.prev().find("span.page-index").html(d+" - "+(parseInt(d)+1)),""!=e?b.prev().find("td.thumb-preview img").attr("src",e):b.prev().find("td.thumb-preview img").attr("src",L+"images/default-thumb.png");else{var f=U(b.parents("div.pages").attr("id")),g="";g+='<tr id="page-display_'+b.parent().find("tr.display").length+'" class="display"><td class="thumb-preview">',g+=""!=e?'<img src="'+e+'" alt=""/>':'<div class="no-cover"></div>',g+='<span class="page-type">'+c+"</span>",g+='<div class="mpc-buttons-wrap page-options">',g+='<a class="add-page mpc-button"><i class="dashicons dashicons-plus"></i> <span class="tooltip">'+mpcthLocalize.addNewPage+"</span></a>",g+='<a class="edit-page mpc-button" href="#'+f+'"><i class="dashicons dashicons-edit"></i> <span class="tooltip">'+mpcthLocalize.editPage+"</span></a>",g+='<a class="preview-page mpc-button" href="#'+f+'"><i class="dashicons dashicons-visibility"></i> <span class="tooltip">'+mpcthLocalize.previewPage+"</span></a>",g+='<a class="delete-page mpc-button" href="#'+f+'"><i class="dashicons dashicons-trash"></i> <span class="tooltip">'+mpcthLocalize.deletePage+"</span></a>",g+='</div></td><td class="navigation">',g+='<a class="up-page mpc-button"><i class="dashicons dashicons-arrow-up-alt2"></i></a>',g+='<input type="checkbox" class="page-checkbox"/>',g+='<span class="desc">page</span>',g+="Double Page"!=c?'<span class="page-index"><span class="index">'+d+"</span></span>":'<span class="page-index"><span class="index">'+d+" - "+(parseInt(d)+1)+"</span></span>",g+='<a class="down-page mpc-button"><i class="dashicons dashicons-arrow-down-alt2"></i></a>',g+='</td><td class="mpc-sortable-handle"><i class="fa fa-arrows-v"></i></td></tr>',b.before(g),b.prev().css({display:"none"}),b.prev().slideDown()}})}function O(b,c){b=U(b);var d=a("table.pages-table tr#pset_"+b).prev().find("#rfbwp_fb_page_index").attr("value"),e=a("table.pages-table tr#pset_"+b).prev().find("select.rfbwp-page-type option:selected").attr("value"),f="Double Page"==e?parseInt(d)+2:parseInt(d)+1;c=U(c);var g=0;a("table.pages-table tr#pset_"+b).find(".field").each(function(){g++;var d=a(this);if(void 0!=d.find("input").attr("name")&&""!=d.find("input").attr("name")&&d.find("input").attr("value",""),"field-rfbwp_fb_page_index"==d.attr("id")&&d.find("#rfbwp_fb_page_index").attr("value",f),"field-rfbwp_fb_page_type"==d.attr("id")){var e='<select class="mp-dropdown rfbwp-page-type" name="rfbwp_options[books]['+c+"][pages]["+b+'][rfbwp_fb_page_type]" id="rfbwp_fb_page_type" title=""><option value="Single Page">Single Page</option><option selected="" value="Double Page">Double Page</option></select>';d.find(".mp-dropdown").remove(),d.find(".controls").prepend(e),o(d.parents("tr#pset_"+b))}if("field-rfbwp_fb_page_bg_image"!=d.attr("id")&&"field-rfbwp_fb_page_bg_image_zoom"!=d.attr("id")||(d.find("img:not(.default)").remove(),d.find("img").show()),"field-rfbwp_page_html"==d.attr("id")||"field-rfbwp_page_html_second"==d.attr("id")){var h=d.find(".html-editor");d.find(".mce-tinymce").remove(),h.val("").show(),h.attr("id","rfbwp_page_html"),k(d),s(d.prev())}if("field-rfbwp_page_css"==d.attr("id")){if(d.find(".rfbwp_page_css_handler").length>0){d.find(".rfbwp_page_css_handler").attr("id","delete_css_editor");var i=ace.edit("delete_css_editor");i.destroy(),i.container.remove()}d.find("#rfbwp_page_css").val(""),j(d.find("#rfbwp_page_css"))}})}function P(b){b.find("tr.display").each(function(){var d,b=a(this),c=0,e=b.next();c=parseInt(e.find("input#rfbwp_fb_page_index").attr("value")),e.hasClass("page-set")&&(c=parseInt(e.find("input#rfbwp_fb_page_index").attr("value")),d=Q(c,b),void 0!=d&&(d.next().after(b),e.hasClass("page-set")&&b.after(e))),K(b.parents("table.pages-table"))})}function Q(b,c){var d;return(""==b||isNaN(b))&&(b=0),a("table.pages-table tr.display").each(function(){var e=a(this),f=e.next();b>parseInt(f.find("input#rfbwp_fb_page_index").attr("value"))&&(d=e),b==f.find("input#rfbwp_fb_page_index").attr("value")&&e.attr("id")!=c.attr("id")&&("Single Page"==f.find("select.rfbwp-page-type option:selected").attr("value")?b++:"Double Page"===f.find("select.rfbwp-page-type option:selected").attr("value")&&(b+=2),c.next().find("input#rfbwp_fb_page_index").attr("value",b),d=e)}),d}function R(b,c,d){var i,e=a("div#bg-content"),f=a("#wpcontent").offset().left+20+215,g=a(window).height(),h=a("#bg-content").height();e.append('<span class="rfbwp-alert '+b+'">'+c+"</span>"),a("span.rfbwp-alert").css("display","none"),h<=g?a("span.rfbwp-alert").addClass("not-fixed"):a("span.rfbwp-alert").removeClass("not-fixed").css({left:f}),a("span.rfbwp-alert").css("display","block").animate({opacity:1},300),i=setInterval(function(){a("span.rfbwp-alert").animate({opacity:0},300,function(){a("span.rfbwp-alert").css("display","none").remove(),clearInterval(i)})},d)}function U(a){return""!==a&&(a=a.toString(),a=a.split("_"),a=a[1]),a}function V(){a("span.breadcrumb").removeClass("selected")}function X(){var b=a("#wpcontent").offset().left+20+405,c=a(window).height(),d=a("#bg-content").height();d<=c?W.find(".fb-spinner").addClass("not-fixed"):W.find(".fb-spinner").removeClass("not-fixed").css({left:b}),W.css({display:"block"}),W.css("visibility","visible"),W.stop(!0).animate({opacity:1},300)}function Y(){W.stop(!0).animate({opacity:0},300,function(){W.css("visibility","hidden"),W.css("display","none")})}function _(a){if(void 0!=a.items){var b=a.items.length;$=a.items,Z="";for(var c=0;c<b;c++){var d=$[c].family;Z+='<option class="mpcth-option-google" data-index="'+c+'" value="'+d+'">'+d+"</option>"}}}function aa(a){var b=a.data.el;b.siblings(".font-handler").val(b.val())}function ba(b){b.each(function(){var b=a(this);b.find(".rfbwp-of-input-font").each(function(){var b=a(this);b.data("select2")||b.append(Z).select2().select2("val",b.siblings(".font-handler").val()).on("change",{el:b},aa)})})}function ca(b){b.find("#rfbwp_fb_hc_fco, #rfbwp_fb_hc_fci, #rfbwp_fb_hc_bco, #rfbwp_fb_hc_bci").each(function(){var b=a(this);b[0].name=b[0].name.replace("[pages][-1]","")})}function da(a){var b=a.parents('.stacked-fields:not([data-section-id="field-rfbwp_fb_nav_menu_type"])');"field-"+a.attr("id")==b.data("section-id")&&(a.is(":checked")?(b.find(".field:not(#"+b.data("section-id")+")").css("display","inline-block"),b.find(".field:not(#"+b.data("section-id")+")").animate({opacity:1},300)):b.find(".field:not(#"+b.data("section-id")+")").animate({opacity:0},300,function(){b.find(".field:not(#"+b.data("section-id")+")").css("display","none")}))}function ea(b){b.find(".stacked-fields .checkbox").each(function(){var b=a(this);da(b)})}function fa(b,c){var d;X(),a.getJSON(mpcthLocalize.presetsURL+c+".json",function(a){for(a=a.preset,d=0;d<a.length-1;d++)ha(b.find("#"+a[d].field_id),a[d].value,a[d].type);R("green",mpcthLocalize.messages.dialogs.presetLoaded,1500),Y()})}function ga(b){var c,d,e,f={preset:[]};b.find(".field").each(function(){var b=a(this);b.hasClass("field-checkbox")?(d=b.find('input[type="checkbox"]').prop("checked"),c=b.find('input[type="checkbox"]').attr("id"),e="checkbox"):b.hasClass("field-select")?(d=b.find("select").val(),c=b.find("select").attr("id"),e="select"):b.hasClass("field-font_select")?(d=b.find("input.font-handler").val(),c=b.find("select").attr("id"),e="font-select"):b.hasClass("field-text-small")?(d=b.find("input").val(),c=b.find("input").attr("id"),e="text"):b.hasClass("field-color")?(d=b.find("input").val(),c=b.find("input").attr("id"),e="color"):b.hasClass("field-icon")&&(d=b.find("input.mpc-icon-select-value").val(),c=b.attr("id"),e="icon"),f.preset.push({field_id:c,value:d,type:e})}),f=JSON.stringify(f)}function ha(a,b,c){void 0!=b&&("text"==c?a.val(b):"color"==c?a.val(b).trigger("change"):"select"==c?a.val(b).trigger("change"):"checkbox"==c?a.prop("checked",b):"icon"==c?(a.find("input").val(b),a.find(".mpc-icon-select i").attr("class",b),""!=b&&a.find(".mpc-icon-select").removeClass("mpc-icon-select-empty")):"font-select"==c&&a.siblings("input").val(b).trigger("change"))}a(".group").hide(),a(".section-group").hide(),a(".tab-group").hide(),a("#mp-option-books").show();var b=a('<div id="curtain"><div class="fb-spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>');a("#bg-content").append(b),a("#confirm_update").on("click",function(b){a("#update_warning").slideUp(function(){a("#update_warning").remove()}),a.post(ajaxurl,{action:"disable_warning"}),b.preventDefault()}),a("#request_backup").on("click",function(a){var b=ajaxurl+"?action=export_flipbooks";location.href=b,a.preventDefault()}),a(".wrap").on("click","table.pages-table a.edit-page",function(b){var c=a(this);c.parents(".pages-table").find(".add-page.cancel").each(function(){a(this).trigger("click")}),c.parents("tr.display").next().is(":visible")||(j(c.parents("tr.display").next().find("#rfbwp_page_css")),k(c.parents("tr.display").next().find("#field-rfbwp_page_html, #field-rfbwp_page_html_second")),s(c.parents("tr.display").next().find(".rfbwp-page-toc-popup")),o(c.parents("tr.display").next())),c.parents("tr.display").next().slideToggle(),c.parents("tr.display").next().find("a.rfbwp-page-save span.desc").text("Save Changes"),c.parents("tr.display").next().find("a.rfbwp-page-save").attr("href","#Save Changes"),b.preventDefault()}),a(".wrap").on("click","table.pages-table a.delete-page",function(b){b.preventDefault();var g,c=a(this),d=c.parents("div.pages").attr("id"),e=c.parents("tr.display").attr("id"),f=c.parents("div.pages");X(),c.parents("tr.display").slideUp("slow",function(){var b=c.parents("tr.display").next("tr.page-set").find("input, select, textarea").serializeArray();c.parents("tr.display").next().hasClass("page-set")&&c.parents("tr.display").next().remove(),c.parents("tr.display").remove();var h=U(e),i=U(d);a.post(ajaxurl,{action:"save_settings",data:b,value:"Delete Page",activeID:i,pageID:h,curPageID:h,updating:"delete_page"},function(b){b.indexOf("mpc_data_size_exceeded")!=-1&&R("red",mpcthLocalize.messages.dialogs.maxInputVars,15e3),Y(),K(f),N(f),0==f.find("table.pages-table tr.page-set").length&&(a("li.button-sidebar.selected a").trigger("click"),a(".books").hide(),g=setInterval(function(){var b=f.attr("id");b=U(b),V(),a(".books tr:nth-child("+(parseInt(b)+1)+")").find("a.view-pages").trigger("click"),clearInterval(g)},150))})})}),a(".wrap").on("click","table.pages-table tr.display a.down-page, table.pages-table tr.display a.up-page",function(b){b.preventDefault();var f,h,j,c=a(this),d=c.parents("tr.display"),e=d.next();if(h=c.hasClass("up-page")?"up":"down","up"==h?e.hasClass("page-set")&&(f=parseInt(e.find("input#rfbwp_fb_page_index").attr("value")),f-="Double Page"==d.prev().find("select.rfbwp-page-type option:selected").text()?2:1):"down"==h&&e.hasClass("page-set")&&(f=parseInt(e.find("input#rfbwp_fb_page_index").attr("value")),f+="Double Page"==e.next().next().find("select.rfbwp-page-type option:selected").text()?2:1),"down"==h){if(e.next().hasClass("display")?j=e.next().next():(j="error",R("orange",mpcthLocalize.messages.dialogs.bottomPage,2e3)),"error"!=j){d.find("span.page-index").text(f),e.find("input#rfbwp_fb_page_index").attr("value",f);var k=parseInt(e.next().next().find("input#rfbwp_fb_page_index").attr("value"),10);k-="Double Page"==e.find("select.rfbwp-page-type option:selected").text()?2:1,e.next().next().find("input#rfbwp_fb_page_index").attr("value",k),d.slideUp("fast",function(){j.after(e),j.after(d),d.slideDown(),P(a(this).parents("div.pages")),N(a(this).parents("div.pages")),e.find("a.rfbwp-page-save").attr("href","#Save Changes"),e.find("a.rfbwp-page-save").trigger("click",["move_down"])})}}else if("up"==h&&(d.prev().prev().hasClass("display")?j=d.prev().prev():(j="error",R("orange",mpcthLocalize.messages.dialogs.topPage,2e3)),"error"!=j)){d.find("span.page-index").text(f),e.find("input#rfbwp_fb_page_index").attr("value",f);var k=parseInt(d.prev().find("input#rfbwp_fb_page_index").attr("value"),10);k+="Double Page"==e.find("select.rfbwp-page-type option:selected").text()?2:1,d.prev().find("input#rfbwp_fb_page_index").attr("value",k),d.slideUp("fast",function(){j.before(d),j.before(e),d.slideDown(),P(a(this).parents("div.pages")),N(a(this).parents("div.pages")),e.find("a.rfbwp-page-save").attr("href","#Save Changes"),e.find("a.rfbwp-page-save").trigger("click",["move_up"])})}}),a(".wrap").on("click","a.add-book",function(b){b.preventDefault(),a.post(ajaxurl,{action:"add_new_book"},function(b){var c=parseInt(b);a("a#mp-option-settings_"+c+"-tab").addClass("add"),a("a#mp-option-settings_"+c+"-tab").click(),V(),a("div.breadcrumbs span.breadcrumb-1 span.active").fadeIn(),a("div.breadcrumbs span.breadcrumb-1").addClass("selected"),a("div.breadcrumbs span.breadcrumb-2").fadeOut(),o(a("#mp-option-settings_"+c).find('[data-toggle-section="field-rfbwp_fb_name"]')),H("book-settings",c),a("div.bottom-nav").find("a.edit-button").attr("value","Save Settings")})}),a(".wrap").on("click","div.pages a.add-page",function(b){b.preventDefault();var c=a(this),d=c.parents("tr.display").attr("id");c.parents(".pages-table").find("tr.display:not(#"+d+")").each(function(){a(this).find(".add-page.cancel").trigger("click")}),K(c.parents("table.pages-table"));var e=c.parents("tr.display").next().clone(!0);if(c.hasClass("cancel")?c.removeClass("cancel").find("span").text(mpcthLocalize.addNewPage):c.addClass("cancel").find("span").text(mpcthLocalize.cancelNewPage),c.parents("tr.display").next().next().hasClass("page-set")&&"none"!=c.parents("tr.display").next().next().css("display"))return void c.parents("tr.display").next().next().slideUp("slow",function(){a(this).remove(),K(c.parents("table.pages-table"))});"none"!=c.parents("tr.display").next().css("display")&&c.parents("tr.display").next().slideUp("slow");c.parents("tr.display").next().after(e),c.parents("tr.display").next().next().find("select.rfbwp-page-type option").prop("selected"),c.parents("tr.display").find(".page-set").slideUp("slow"),c.parents("tr.display").next().next().slideDown("slow"),c.parents("tr.display").next().next().find("a.rfbwp-page-save span.desc").text("Save Page"),c.parents("tr.display").next().next().find("a.rfbwp-page-save").attr("href","#Save Page"),K(c.parents("table.pages-table")),O(c.parents("tr.display").next().next().attr("id"),c.parents(".group.pages").attr("id"))}),a(".wrap").on("click","img.rfbwp-first-book",function(b){b.preventDefault(),a(this).parents(".books").find("a.add-book").trigger("click")}),a(".wrap").on("click","div.pages img.rfbwp-first-page",function(b){b.preventDefault();var d,e,f,c=a(this);Y(),a(".page-settings").css({display:"block"}),a.post(ajaxurl,{action:"page_form"},function(b){f=U(c.parents("div.pages").attr("id")),e='<div class="rfbwp-add-page-form">',e+=b,a.post(ajaxurl,{action:"get_books_page_count",book_id:f},function(b){d=parseInt(b),c.prev().find("#pset_"+d).css({display:"block"}),e=e.replace(/\[books]\[0]/g,"[books]["+f+"]"),e=e.replace(/\[pages\]\[0\]/g,"[pages]["+d+"]"),c.prev().find("div#ps_"+d).append(e),c.fadeOut(),c.prev().find("div#ps_"+d).find("div.rfbwp-add-page-form").find("input#rfbwp_fb_page_index").attr("value","0"),c.prev().find("div#ps_"+d).find("div.controls").children().each(function(){var c,d,b=a(this);void 0!=b.attr("name")&&""!=b.attr("name")&&(c=b.attr("name"),c=c.split("[books]["),d=c[1].split("[pages]"),c=c[0]+"[books]["+f+"][pages]"+d[1],b.attr("name",c),"rfbwp_fb_page_index"==b.attr("id")&&b.val(0))}),j(c.prev().find("div#ps_"+d).find("#rfbwp_page_css")),k(c.prev().find("div#ps_"+d).find("#field-rfbwp_page_html, #field-rfbwp_page_html_second")),o(c.prev().find("div#ps_"+d)),c.prev().find("div#ps_"+d).find("div.rfbwp-add-page-form").slideDown(),Y()})})}),a("form#options-form").submit(function(a){return a.preventDefault(),!1}),a(".wrap").on("submit","form#options-form",function(a){return a.preventDefault(),!1}),a(".wrap").on("click","a.edit-button-alt",function(b){a(".bottom-nav .edit-button").trigger("click"),b.preventDefault()}),a(".wrap").on("keydown","form#options-form input",function(a){13==a.keyCode&&(a.preventDefault(),a.stopPropagation())}),a(".wrap").on("click","form#options-form input.save-button, form#options-form a.edit-button, a.rfbwp-page-save",function(b,d){function p(){a.post(ajaxurl,{action:"save_settings",data:f,activeID:l,curPageID:g,updating:m,value:j,moveDir:d},function(b){a(window).trigger("rfbwp-page-updated"),b.indexOf("mpc_data_size_exceeded")!=-1&&R("red",mpcthLocalize.messages.dialogs.maxInputVars,15e3),Y(),"book"==m&&a("div.group").each(function(){var c,b=a(this);if("block"==b.css("display")&&b.hasClass("settings"))return c=U(b.attr("id")),a("#mp-option-settings_"+l).find(".breadcrumb-2").fadeIn(),R("green",mpcthLocalize.messages.dialogs.bookSaved,2e3),!1})})}b.preventDefault();var f,g,i,j,k,l,e=a(this);X(),void 0!=e.parents("div.page-settings").attr("id")&&(g=e.parents("div.page-settings").attr("id"),g=U(g)),i=e.attr("href").toString(),i=i.split("#"),i=i[1],j=i,void 0!=e.parents("div.pages").attr("id")?k=e.parents("div.pages").attr("id"):e.parents("form").find("div.settings").each(function(){"block"==a(this).css("display")&&(k=a(this).attr("id"))}),l=void 0==k?j:U(k);var m="",n=0!=e.parents(".page-set").siblings("#page-display_"+g).length;if(m=void 0!=d?"move_page":void 0==g?"book":0==g?"first_page":void 0!=g&&n?"edit_page":"new_page",e.hasClass("rfbwp-page-save")&&"0"!=g){var o="#page-display_"+(U(e.parents(".page-set").attr("id"))-1);e.parents(".pages-table").find(o+" .add-page").hasClass("cancel")&&e.parents(".pages-table").find(o+" .add-page").removeClass("cancel").find("span").text(mpcthLocalize.addNewPage),e.parents("tr.page-set").slideUp("down",function(){J(a(this).attr("id")),"Save Changes"==i?(c(e.parents("tr.page-set").prev()),N(e.parents("div.pages"))):(N(e.parents("div.pages")),P(e.parents("div.pages")),N(e.parents("div.pages"))),e.trigger("rfbwp.page-save"),f=e.parents("tr.page-set").find("input, select, textarea").serializeArray(),p()}),a("html, body").animate({scrollTop:e.parents("tr.page-set").prev(".display").offset().top-32},250)}else"sortable"==d?(m="edit_pages",f=a("#mp-option-pages_"+j).find("input, select, textarea").serializeArray(),p()):"0"==g?(e.parents("tr.page-set").slideUp("down",function(){"Save Changes"==i?(c(e.parents("tr.page-set").prev()),N(e.parents("div.pages"))):N(e.parents("div.pages")),j="Edit Settings",e.trigger("rfbwp.first-page-save"),f=e.parents("tr.page-set").find("input, select, textarea").serializeArray(),p()}),a("html, body").animate({scrollTop:e.parents("tr.page-set").prev(".display").offset().top-32},250)):(j=e.val(),"Save Settings"!=e.val()&&a("#mp-option-settings_"+l).find(".breadcrumb-2").fadeIn(),(""==j&&e.hasClass("edit-button")||void 0==j&&e.hasClass("edit-button"))&&(j="Edit Settings"),f=a("#mp-option-settings_"+l).find("input, select, textarea").serializeArray(),p());return!1}),a(".wrap").on("rfbwp.firstTabReady",function(b,c){a(".books tr:nth-child("+(parseInt(c)+1)+")").find("a.view-pages").trigger("click")}),a(".wrap").on("click","table.books a.delete-book",function(b){b.preventDefault();var c=a(this),d=c.parents("table.books"),e=c.attr("href").split("#");e=e[1],confirm(mpcthLocalize.messages.dialogs.deleteBook+' "'+c.parents("td").find(".book-name .pretty-name").text()+'"')&&(X(),a.post(ajaxurl,{action:"delete_book",id:e},function(b){b.indexOf("mpc_data_size_exceeded")!=-1&&R("red",mpcthLocalize.messages.dialogs.maxInputVars,15e3),c.parent().parent().slideUp(300,function(){c.parents("tr").remove(),d.parents("form").find("div#mp-option-pages_"+e).remove(),d.parents("form").find("div#mp-option-settings_"+e).remove()}),a("li.button-sidebar.selected a").trigger("click",e),Y()}))}),a(".wrap").on("click","div#bg-content div#sidebar ul > li:first-child",function(b,c){b.preventDefault();var d=!1,e=!1,f=!1;a("div.field-books span").remove(),a("div.field-books table.books").remove(),a("div.field-books a.add-book").remove(),a("div#top-nav ul#mp-section-flipbooks-tab li").each(function(){var b=a(this);(b.find("a").hasClass("settings")||b.find("a").hasClass("pages"))&&b.remove()}),a("form#options-form div.group").each(function(){var b=a(this);(b.hasClass("settings")||b.hasClass("pages"))&&b.remove()}),a.post(ajaxurl,{action:"rfbwp_refresh_books"},function(b){a("div.field-books div.controls").children().remove(),a("div.field-books div.controls").append(b),d=!0,void 0!=c&&c>-1&&d&&e&&f&&a(".wrap").trigger("rfbwp.firstTabReady",c)}),a.post(ajaxurl,{action:"rfbwp_refresh_tabs"},function(b){a("div#top-nav ul#mp-section-flipbooks-tab").append(b),e=!0,void 0!=c&&c>-1&&d&&e&&f&&a(".wrap").trigger("rfbwp.firstTabReady",c)}),a.post(ajaxurl,{action:"rfbwp_refresh_tabs_content"},function(b){Y(),a("form#options-form div.group.books").after(b),a("form#options-form div.group").each(function(){var b=a(this);(b.hasClass("settings")||b.hasClass("pages"))&&b.hide()}),a("#mp-option-books").trigger("rfbwp.ajaxReady"),f=!0,void 0!=c&&c>-1&&d&&e&&f&&a(".wrap").trigger("rfbwp.firstTabReady",c)})}),a(".hide-checkbox").each(function(){var b=a(this).attr("id"),c=b.split("_checkbox");"checked"==a(this).attr("checked")?a("."+c[0]+"_wrap").show():a("."+c[0]+"_wrap").hide()}),a(".hide-checkbox").change(function(){var b=a(this).attr("id"),c=b.split("_checkbox");if("checked"==a(this).attr("checked")?a("."+c[0]+"_wrap").slideDown():a("."+c[0]+"_wrap").slideUp(),a(this).parent().find("div").hasClass("mp-related-object")){var d=a(this).parent().find("div.mp-related-object").text();a("#"+d+"_checkbox").attr("checked",!1),a("."+d+"_wrap").slideUp()}}),a("textarea.displayall").each(function(){a(this).val(a(this).val())}),a("textarea.displayall-upload").each(function(){
var b=a(this).val(),c=b.split("http");b="",a.each(c,function(a,c){0!=a&&(b+="http"+c)}),a(this).val(b)}),a(".wrap").on("click",".button-tab a, a.book-settings, a.view-pages",function(b){X();var c=a(this);c.addClass("selected");var d=c.attr("href");c.hasClass("book-settings")?(o(a(d).find('[data-toggle-section="field-rfbwp_fb_name"]')),H("book-settings",U(c.attr("href")))):c.hasClass("books")?H("books"):c.hasClass("add")?H("add"):c.hasClass("view-pages")&&H("view-pages"),a(".group").hide();var e;a(d).find("div.page-settings").each(function(){var b=a(this),c=b.attr("id");c=U(c),e=d+" tr#pset_"+c+" td",a(e).append(b),a(d+" tr#pset_"+c).css({display:"none"})});var f=U(d);void 0==f?(a("#rfbwp_tools").attr("data-book-id","").stop(!0,!0),a("#rfbwp_import_id").val("")):(a("#rfbwp_tools").attr("data-book-id",f).stop(!0,!0),a("#rfbwp_import_id").val(f)),void 0!=f&&a.post(ajaxurl,{action:"set_active_book",activeID:f},function(){a(d).trigger("rfbwp.ajaxReady")}),c.hasClass("view-pages")&&(l(a(d)),F(a(d)),n(a(d))),c.hasClass("book-settings")&&(ca(a(d)),F(a(d))),a(d).fadeIn(),Y(),b.preventDefault()}),a(".group").on("rfbwp.ajaxReady",h),a(".wrap").on("click",".button-sidebar a",function(b,c){var d=a(this);d.parent().hasClass("selected")||(a(".button-sidebar").removeClass("selected"),d.parent().addClass("selected"),a("div.breadcrumbs").fadeOut()),a(".tab-group").fadeOut("slow");var e=d.attr("href")+"-tab .button-tab:first a";a(e).trigger("click"),b.preventDefault()}),a(".wrap").on("click","span.breadcrumb",function(b){if(!a(this).is(".selected")){b.preventDefault(),X();var e,f,c=a(this),d=c.parents("div.group");if(c.hasClass("selected")){if(!c.hasClass("image-batch"))return;c.removeClass("image-batch")}if(a("span.breadcrumb").each(function(){a(this).removeClass("selected")}),f=U(d.attr("id")),a(".group").hide(),c.hasClass("breadcrumb-1"))e="#mp-option-settings_"+f,ca(a(e)),F(a(e)),o(a(e).find('[data-toggle-section="field-rfbwp_fb_name"]')),a(e).fadeIn(),H("book-settings");else if(c.hasClass("breadcrumb-2")){e="#mp-option-pages_"+f,l(a(e)),a(e).find("div.page-settings").each(function(){var b=a(this),c=b.attr("id"),d="";c=U(c),d=e+" tr#pset_"+c+" td",a(d).append(b),a(e+" tr#pset_"+c).css({display:"none"})}),n(a(e)),F(a(e));var g=c.parents(".group").attr("id");g=U(g),a("li.button-sidebar.selected a").trigger("click",g),a(".books").hide(),a(e).fadeIn(),H("view-pages")}else c.hasClass("breadcrumb-0")&&(e="#mp-option-books",H("books-shelf"),a(e).find("div.breadcrumbs").remove(),a(e).fadeIn());Y()}});var i=[];a(".wrap").on("click","#field-rfbwp_fb_page_columns_sc .rfbwp-page-columns-sc",function(){var b=a(this).parents("tr.page-set").find("#field-rfbwp_page_html_second"),c=a(this).parents("tr.page-set").find("#field-rfbwp_fb_page_toc_popup_second");b.toggleClass("active"),c.toggleClass("active")}),a(".wrap").on("change","#field-rfbwp_fb_page_type .mp-dropdown",function(){var b=a(this),c=b.parents("tr.page-set"),d=b.parents("tr.page-set").find("#field-rfbwp_page_html_second"),e=c.find("#rfbwp_fb_page_type").val();"Single Page"==e&&d.hasClass("active")?(c.find("#field-rfbwp_fb_page_columns_sc a").trigger("click"),c.find("#field-rfbwp_fb_page_columns_sc").removeClass("active")):"Double Page"!=e||d.hasClass("active")||(c.find("#field-rfbwp_fb_page_columns_sc").addClass("active"),c.find("#field-rfbwp_fb_page_columns_sc a").trigger("click"))}),a(".wrap").on("mousedown","a.rfbwp-page-save",function(){var b=a(this),c=b.parents(".page-settings").find(".html-editor");c.each(function(){var b=a(this),c=tinyMCE.get(b.attr("id")).getContent().replace(/<p>&nbsp;<\/p>$/,"");tinyMCE.get(b.attr("id")).selection.select(tinyMCE.activeEditor.getBody(),!0),tinyMCE.get(b.attr("id")).selection.collapse(!1),b.val(c)})}),H("books"),a(".wrap").on("click","div.mp-toggle-header",function(b){b.preventDefault();var c=a(this),d=c.next("div.mp-toggle-content");c.hasClass("open")?c.removeClass("open"):c.addClass("open"),p(d),q(d),ba(d),o(d),ea(d),ca(d),F(d);var e="field-rfbwp_fb_nav_menu_type"==d.attr("data-toggle-section");e&&m(d),t(d),c.next("div.mp-toggle-content").slideToggle("slow")}),a(".wrap").on("change",'div.mp-toggle-content[data-toggle-section="field-rfbwp_fb_nav_menu_type"] .stacked-fields .checkbox',function(){var b=a(this).parents("div.mp-toggle-content");t(b)});var B=(a("#rfbwp_flipbook_batch_ids"),a("#rfbwp_flipbook_batch_images_wrap"),a("#rfbwp_flipbook_batch_select"),a("#rfbwp_flipbook_batch_ids"),a("#rfbwp_flipbook_batch_images_wrap_large"),a("#rfbwp_flipbook_batch_select_large"),a("#rfbwp_flipbook_batch_import"),wp.media);B.view.Settings.Gallery=B.view.Settings.Gallery.extend({render:function(){return this}}),a("#rfbwp_flipbook_batch_import").on("click",function(b){var c=a("#rfbwp_flipbook_batch_ids").val(),d=a("#rfbwp_flipbook_batch_ids_large").val(),e=(c.match(/,/g)||[]).length+1,f=(d.match(/,/g)||[]).length+1,g=!1;""!=c&&""!=d?e!=f?R("red",mpcthLocalize.messages.dialogs.normalLarge,3e3):g=!0:""==c&&""!=d?g=!0:""!=c&&""==d?g=!0:R("red",mpcthLocalize.messages.dialogs.noImages,3e3),g&&a.post(ajaxurl,{action:"batch_import",book_id:a("#rfbwp_tools").attr("data-book-id"),images_ids:a("#rfbwp_flipbook_batch_ids").val(),images_ids_large:a("#rfbwp_flipbook_batch_ids_large").val(),double_page:a("#rfbwp_flipbook_batch_double").is(":checked")},function(b){a("#rfbwp_flipbook_batch_ids").val(""),a("#rfbwp_flipbook_batch_images_wrap").html(""),a("#rfbwp_flipbook_batch_ids_large").val(""),a("#rfbwp_flipbook_batch_images_wrap_large").html(""),"error-book-id"==b?R("red","Wrong book ID.",3e3):"error-page-id"==b&&R("red","Wrong page ID.",3e3),R("green",mpcthLocalize.messages.dialogs.importFinished,3e3),a.post(ajaxurl,{action:"rfbwp_refresh_tabs_content"},function(b){X(),a("form#options-form .group.settings, form#options-form .group.pages").remove(),a("form#options-form div.group.books").after(b),a("form#options-form div.group").each(function(){var b=a(this);(b.hasClass("settings")||b.hasClass("pages"))&&b.hide()}),a("#mp-option-pages_"+a("#rfbwp_tools").attr("data-book-id")).find(".breadcrumbs .breadcrumb-2").trigger("click"),Y()})}),b.preventDefault()}),a(".wrap").on("click",".upload_button",function(){if(e)return void e.open();var b=["image/jpeg","image/png","image/gif"],c=a(this).siblings(".upload"),d=a(this).siblings(".screenshot"),e=wp.media({title:mpcthLocalize.messages.dialogs.selectImage,button:{text:mpcthLocalize.messages.dialogs.insertImage},multiple:!1});e.on("select",function(){var a=e.state().get("selection").first().toJSON();b.indexOf(a.mime)>=0&&(c.val(a.url),d.find("img:not(.default)").remove(),d.prepend('<img src="'+a.url+'" alt="" />'))}),e.open()}),a(".wrap").on("click",".upload_file_button",function(){if(d)return void d.open();var b=a(this).siblings(".uploaded_file_name"),c=a(this).siblings(".upload"),d=wp.media({title:mpcthLocalize.messages.dialogs.selectImage,button:{text:mpcthLocalize.messages.dialogs.insertImage},multiple:!1});d.on("select",function(){var a=d.state().get("selection").first().toJSON();c.val(a.id),b.html(a.filename)}),d.open()}),a("#rfbwp_flipbook_batch_select, #rfbwp_flipbook_batch_select_large").on("click",function(b){var c="";a(this).is("#rfbwp_flipbook_batch_select_large")&&(c="_large");var d=a("#rfbwp_flipbook_batch_ids"+c).val(),e=d.length>0&&C(d),f=wp.media({title:mpcthLocalize.messages.dialogs.selectImages,button:{text:mpcthLocalize.messages.dialogs.insertImages},frame:"post",state:"gallery-edit",multiple:!0,selection:e});f.open(),f.on("update",function(b){for(var d=b.models,e=[],f="",g=0;g<d.length;g++){var h="undefined"==typeof d[g].attributes.sizes.thumbnail?d[g].attributes.sizes.full.url:d[g].attributes.sizes.thumbnail.url;e[g]=d[g].id,f+='<img width="50px" height="50px" src="'+h+'" class="rfbwp-batch-image" alt="Batch image '+g+'">'}a("#rfbwp_flipbook_batch_ids"+c).val(e.join(",")),a("#rfbwp_flipbook_batch_images_wrap"+c).html(f)}),b.preventDefault()}),a("#rfbwp_flipbook_batch_clear, #rfbwp_flipbook_batch_clear_large").on("click",function(b){var c="";a(this).is("#rfbwp_flipbook_batch_clear_large")&&(c="_large"),a("#rfbwp_flipbook_batch_ids"+c).val(""),a("#rfbwp_flipbook_batch_images_wrap"+c).fadeOut(function(){a("#rfbwp_flipbook_batch_images_wrap"+c).html("").show()}),b.preventDefault()}),a("#rfbwp_tools_toggle_title").on("click",function(b){var c=a(this),d=a("#rfbwp_tools_toggle_content");c.is(".option-open")?(c.removeClass("option-open"),d.slideUp()):(c.addClass("option-open"),d.slideDown()),b.preventDefault()});var D=a("#rfbwp_page_preview"),E=a("#rfbwp_page_preview_wrap");D.on("click",function(a){D.fadeOut(250,function(){E.find(".flipbook-container").removeClass("rfbwp-inited"),E.html(""),D.css("transform","")}),D._active=void 0,a.preventDefault()}),a(window).on("rfbwp-page-updated",function(){void 0!=D._active&&D._active.trigger("click")}),a("#options-form").on("click",".pages .breadcrumbs .breadcrumb:not(.selected)",function(){void 0!=D._active&&D.trigger("click")}),a("#options-form").on("click",".pages .thumb-preview .preview-page",function(b){var c=a(this),d=c.parents("div.pages").attr("id"),e=c.parents(".display").attr("id");D.fadeOut(250,function(){a.post(ajaxurl,{action:"preview_page",book_id:U(d),page_id:U(e)},function(b){"error-book-id"==b?R("red",mpcthLocalize.messages.dialogs.bookID,3e3):"error-page-id"==b?R("red",mpcthLocalize.messages.dialogs.bookID,3e3):(E.html(b),D.fadeIn(250),E.find(".flipbook-container").addClass("rfbwp-inited"),E.find("img.lazy-load").each(function(){var b=a(this);b.attr("src",b.attr("data-src"))}),D.width()>800?D.css("transform","scale("+(800/D.width()).toFixed(2)+")"):D.height()>a(window).height()-100&&D.css("transform","scale("+((a(window).height()-100)/D.height()).toFixed(2)+")"))})}),D._active=c,b.preventDefault()}),a("#rfbwp_import_back_url").val(location.href),a("#rfbwp_flipbook_import").on("click",function(b){a("#rfbwp_import").click(),b.preventDefault()}),a("#rfbwp_flipbook_export").on("click",function(b){var c=ajaxurl+"?action=export_flipbooks&book_id="+a("#rfbwp_tools").attr("data-book-id");location.href=c,b.preventDefault()});var L=a("div.mpc-logo").css("background-image");L=navigator.userAgent.search("Firefox")>-1||navigator.userAgent.search("MSIE 8.0")>-1?L.split('url("'):L.split("url("),L=L[1],L=L.split("massive-panel"),L=L[0]+"massive-panel/";var W=a("#curtain");a(".wrap").slideDown(500);var Z="",$=[];0==mpcthLocalize.googleFonts?a.getJSON("https://www.googleapis.com/webfonts/v1/webfonts?callback=?&key="+mpcthLocalize.googleAPIKey,function(b){if(void 0!=b.error)a("#mpcth_menu_font").after('<div class="mpcth-of-error">'+mpcthLocalize.googleAPIErrorMsg+"</div>");else{for(var c={items:[]},d=0;d<b.items.length;d++)c.items[d]={},c.items[d].family=b.items[d].family,c.items[d].variants=b.items[d].variants;jQuery.ajax({type:"POST",url:ajaxurl,action:"mpcth_cache_google_webfonts",google_webfonts:JSON.stringify(c),dataType:"json"}),_(b)}}):_(JSON.parse(mpcthLocalize.googleFonts)),a(".wrap").on("change",".stacked-fields .checkbox",function(){var b=a(this);da(b)}),a(".wrap").on("change","#rfbwp_fb_pre_style",function(){var b=a(this),c=b.parents(".group.settings"),d=b.val();""!==d&&null!==d&&fa(c,d)}),a(".wrap").on("click","#rfbwp_fb_down_preset",function(b){var c=a(this),d=c.parents(".group.settings");ga(d),b.preventDefault()})})}();
